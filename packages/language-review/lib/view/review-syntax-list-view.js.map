{"version":3,"file":"review-syntax-list-view.js","sourceRoot":"","sources":["review-syntax-list-view.ts"],"names":[],"mappings":"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","sourcesContent":["// check this https://github.com/yujinakayama/atom-lint/blob/master/lib/lint-view.coffee\n\nimport { $, ScrollView } from \"atom-space-pen-views\";\n\nimport * as ReVIEW from \"review.js\";\n\nimport * as V from \"../util/const\";\nimport * as logger from \"../util/logger\";\nimport ReVIEWRunner from \"../util/review-runner\";\n\nexport default class ReVIEWSyntaxListView extends ScrollView {\n\n    editorId: string;\n    editor: AtomCore.IEditor;\n\n    runner: ReVIEWRunner;\n\n    acceptableSyntaxes: ReVIEW.AcceptableSyntaxes;\n\n    static deserialize(state: any): ReVIEWSyntaxListView {\n        return new ReVIEWSyntaxListView(state);\n    }\n\n    static content(): any {\n        return this.div({ class: \"review-syntax-list native-key-bindings\", tabindex: -1 });\n    }\n\n    constructor(params: { editorId?: string; filePath?: string; } = {}) {\n        super();\n\n        this.editorId = params.editorId;\n\n        if (this.editorId) {\n            let promise = this.resolveEditor(this.editorId);\n            promise.then(editor => {\n                this.runner = new ReVIEWRunner({ editor: editor });\n                this.handleEvents();\n            }).catch(_reason => {\n                // The editor this preview was created for has been closed so close\n                // this preview since a preview cannot be rendered without an editor\n                let view = this.jq.parents(\".pane\").view();\n                if (view) {\n                    view.destroyItem(this);\n                }\n            });\n        } else {\n            throw new Error(\"editorId is required\");\n        }\n    }\n\n    get jq(): JQuery {\n        // dirty hack\n        return <any>this;\n    }\n\n    serialize() {\n        return {\n            deserializer: \"ReVIEWSyntaxListView\",\n            filePath: null as string,\n            editorId: this.editorId,\n        };\n    }\n\n    destroy() {\n        if (this.runner) {\n            // https://github.com/vvakame/language-review/issues/54#issuecomment-210971891\n            this.runner.deactivate();\n        }\n    }\n\n    resolveEditor(editorId: string): Promise<AtomCore.IEditor> {\n        return new Promise<AtomCore.IEditor>((resolve, reject) => {\n            let func = () => {\n                let editor = this.editorForId(editorId);\n                this.editor = editor;\n\n                if (editor) {\n                    this.jq.trigger(\"title-changed\");\n                    resolve(editor);\n                } else {\n                    reject();\n                }\n            };\n\n            if (atom.workspace) {\n                func();\n            } else {\n                atom.packages.onDidActivateInitialPackages(() => {\n                    func();\n                });\n            }\n        });\n    }\n\n    editorForId(editorId: string) {\n        let foundEditors = atom.workspace.getTextEditors().filter(editor => {\n            let id = editor.id;\n            if (!id) {\n                return false;\n            }\n            return id.toString() === editorId.toString();\n        });\n        return foundEditors[0];\n    }\n\n    handleEvents() {\n        atom.commands.add(<any>this, \"core:move-up\", () => this.jq.scrollUp());\n        atom.commands.add(<any>this, \"core:move-down\", () => this.jq.scrollDown());\n\n        atom.commands.add(\"atom-workspace\", \"language-review:zoom-in\", () => {\n            let zoomLevel = parseFloat(this.jq.css(\"zoom\")) || 1;\n            this.jq.css(\"zoom\", zoomLevel + 0.1);\n        });\n        atom.commands.add(\"atom-workspace\", \"language-review:zoom-out\", () => {\n            let zoomLevel = parseFloat(this.jq.css(\"zoom\")) || 1;\n            this.jq.css(\"zoom\", zoomLevel - 0.1);\n        });\n        atom.commands.add(\"atom-workspace\", \"language-review:reset-zoom\", () => {\n            this.jq.css(\"zoom\", 1);\n        });\n\n        this.runner.on(\"syntax\", acceptableSyntaxes => {\n            this.acceptableSyntaxes = acceptableSyntaxes;\n            this.renderSyntaxList();\n        });\n\n        this.runner.activate();\n    }\n\n    renderSyntaxList() {\n        if (!this.acceptableSyntaxes) {\n            return;\n        }\n\n        let $div = $(\"<div>\");\n        $(\"<h1>\").text(\"Re:VIEW記法の説明\").appendTo($div);\n        /* tslint:disable:variable-name */\n        let SyntaxType = ReVIEW.SyntaxType;\n        /* tslint:enable:variable-name */\n        this.acceptableSyntaxes.acceptableSyntaxes.forEach(syntax => {\n            let $syntax = $(\"<div>\");\n            switch (syntax.type) {\n                case SyntaxType.Other:\n                    switch (syntax.symbolName) {\n                        case \"headline\":\n                            $(\"<span>\").text(\"={???} タイトル\").appendTo($syntax);\n                            break;\n                        case \"ulist\":\n                            $(\"<span>\").text(\" * 文字列\").appendTo($syntax);\n                            break;\n                        case \"olist\":\n                            $(\"<span>\").text(\" 1. 文字列\").appendTo($syntax);\n                            break;\n                        case \"dlist\":\n                            $(\"<span>\").text(\" : 定義 説明\").appendTo($syntax);\n                            break;\n                        default:\n                            logger.warn(\"test\", syntax);\n                            break;\n                    }\n                    break;\n                case SyntaxType.Inline:\n                    $(\"<span>\").text(\"@<\" + syntax.symbolName + \">{}\").appendTo($syntax);\n                    break;\n                case SyntaxType.Block:\n                    syntax.argsLength.forEach(len => {\n                        let text = \"//\" + syntax.symbolName;\n                        for (let i = 0; i < len; i++) {\n                            text += \"[???]\";\n                        }\n                        $(\"<div>\").text(text).appendTo($syntax);\n                    });\n                    break;\n                default:\n            }\n            let $description = $(\"<pre>\").text(syntax.description);\n            $description.appendTo($syntax);\n            $syntax.append(\"<hr>\");\n            $syntax.appendTo($div);\n            $syntax.data(\"syntax\", syntax);\n        });\n        this.jq.empty();\n        this.jq.append($div);\n    }\n\n    getTitle(): string {\n        if (this.editor) {\n            return `${this.editor.getTitle()} Syntax List`;\n        } else {\n            return \"Re:VIEW Syntax List\";\n        }\n    }\n\n    getURI(): string {\n        return `language-review://${V.syntaxListHost}/${this.editorId}`;\n    }\n\n    getPath(): string {\n        if (this.editor) {\n            return this.editor.getPath();\n        }\n        return null;\n    }\n}\n\natom.deserializers.add(ReVIEWSyntaxListView);\n"]}