{"version":3,"file":"review-preview-view.js","sourceRoot":"","sources":["review-preview-view.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from \"path\";\n\nimport { $, $$$, ScrollView } from \"atom-space-pen-views\";\n\nimport * as V from \"../util/const\";\nimport * as logger from \"../util/logger\";\nimport { ReportLevel } from \"review.js\";\nimport ReVIEWRunner from \"../util/review-runner\";\n\nexport default class ReVIEWPreviewView extends ScrollView {\n\n    editorId: string;\n    editor: AtomCore.IEditor;\n\n    runner: ReVIEWRunner;\n\n    fontSizeObserveSubscription: AtomCore.IDisposable;\n    fontFamilyObserveSubscription: AtomCore.IDisposable;\n\n    static deserialize(state: any): ReVIEWPreviewView {\n        return new ReVIEWPreviewView(state);\n    }\n\n    static content(): any {\n        return this.div({ class: \"review-preview native-key-bindings\", tabindex: -1 });\n    }\n\n    constructor(params: { editorId: string; }) {\n        super();\n\n        this.editorId = params.editorId;\n\n        if (this.editorId) {\n            let promise = this.resolveEditor(this.editorId);\n            promise.then(editor => {\n                this.runner = new ReVIEWRunner({ editor: editor });\n                this.handleEvents();\n            }).catch(_reason => {\n                // The editor this preview was created for has been closed so close\n                // this preview since a preview cannot be rendered without an editor\n                let view = this.jq.parents(\".pane\").view();\n                if (view) {\n                    view.destroyItem(this);\n                }\n            });\n        } else {\n            throw new Error(\"editorId is required\");\n        }\n    }\n\n    get jq(): JQuery {\n        // dirty hack\n        return <any>this;\n    }\n\n    attached() {\n        this.fontSizeObserveSubscription = atom.config.observe(\"editor.fontSize\", newValue => {\n            this.adjustFont({ fontSize: newValue });\n        });\n        this.fontFamilyObserveSubscription = atom.config.observe(\"editor.fontFamily\", newValue => {\n            this.adjustFont({ fontFamily: newValue });\n        });\n    }\n\n    detached() {\n        this.fontSizeObserveSubscription.dispose();\n        this.fontSizeObserveSubscription = null;\n        this.fontFamilyObserveSubscription.dispose();\n        this.fontFamilyObserveSubscription = null;\n    }\n\n    adjustFont({fontSize, fontFamily}: { fontSize?: number; fontFamily?: string }) {\n        fontSize = fontSize || atom.config.get(\"editor.fontSize\");\n        fontFamily = fontFamily || atom.config.get(\"editor.fontFamily\");\n        this.jq.css(\"font-family\", fontFamily);\n        this.jq.css(\"font-size\", fontSize);\n    }\n\n    serialize() {\n        return {\n            deserializer: \"ReVIEWPreviewView\",\n            filePath: null as string,\n            editorId: this.editorId,\n        };\n    }\n\n    destroy() {\n        if (this.runner) {\n            // https://github.com/vvakame/language-review/issues/54#issuecomment-210971891\n            this.runner.deactivate();\n        }\n    }\n\n    resolveEditor(editorId: string): Promise<AtomCore.IEditor> {\n        return new Promise<AtomCore.IEditor>((resolve, reject) => {\n            let func = () => {\n                let editor = this.editorForId(editorId);\n                this.editor = editor;\n\n                if (editor) {\n                    this.jq.trigger(\"title-changed\");\n                    resolve(editor);\n                } else {\n                    reject();\n                }\n            };\n\n            if (atom.workspace) {\n                func();\n            } else {\n                atom.packages.onDidActivateInitialPackages(() => {\n                    func();\n                });\n            }\n        });\n    }\n\n    editorForId(editorId: string) {\n        let foundEditors = atom.workspace.getTextEditors().filter(editor => {\n            let id = editor.id;\n            if (!id) {\n                return false;\n            }\n            return id.toString() === editorId.toString();\n        });\n        return foundEditors[0];\n    }\n\n    handleEvents() {\n        atom.commands.add(<any>this, \"core:move-up\", () => this.jq.scrollUp());\n        atom.commands.add(<any>this, \"core:move-down\", () => this.jq.scrollDown());\n\n        atom.commands.add(\"atom-workspace\", \"language-review:zoom-in\", () => {\n            let zoomLevel = parseFloat(this.jq.css(\"zoom\")) || 1;\n            this.jq.css(\"zoom\", zoomLevel + 0.1);\n        });\n        atom.commands.add(\"atom-workspace\", \"language-review:zoom-out\", () => {\n            let zoomLevel = parseFloat(this.jq.css(\"zoom\")) || 1;\n            this.jq.css(\"zoom\", zoomLevel - 0.1);\n        });\n        atom.commands.add(\"atom-workspace\", \"language-review:reset-zoom\", () => {\n            this.jq.css(\"zoom\", 1);\n        });\n\n        let changeHandler = () => {\n            let pane = atom.workspace.paneForURI(this.getURI());\n            if (pane && pane !== atom.workspace.getActivePane()) {\n                pane.activateItem(this);\n            }\n        };\n\n        let savedScrollTop: number = 0;\n        let inFailedContext = false;\n        this.runner.on(\"start\", () => {\n            if (!inFailedContext) {\n                savedScrollTop = this.jq.scrollTop();\n            }\n            this.showLoading();\n        });\n        this.runner.on(\"report\", reports => {\n            logger.log(reports);\n        });\n        this.runner.on(\"compile-success\", book => {\n            inFailedContext = false;\n            changeHandler();\n            book.allChunks[0].builderProcesses.forEach(process => {\n                let $html = this.resolveImagePaths(process.result);\n                this.jq.empty().append($html);\n            });\n            this.jq.scrollTop(savedScrollTop);\n        });\n        this.runner.on(\"compile-failed\", book => {\n            inFailedContext = true;\n            changeHandler();\n            let $result = $(\"<div>\");\n            book.allChunks[0].process.reports.forEach(report => {\n                let $report = $(\"<div>\");\n                let type = \"Unknown\";\n                switch (report.level) {\n                    case ReportLevel.Error:\n                        type = \"Error\";\n                        $report.addClass(\"text-error\");\n                        break;\n                    case ReportLevel.Warning:\n                        type = \"Warning\";\n                        $report.addClass(\"text-warning\");\n                        break;\n                    case ReportLevel.Info:\n                        type = \"Info\";\n                        $report.addClass(\"text-info\");\n                        break;\n                    default:\n                }\n\n                let line = report.nodes[0].location.start.line;\n                let column = report.nodes[0].location.start.column - 1;\n                $report.text(`[${line},${column}] ${type} ${report.message}`);\n                $report.appendTo($result);\n            });\n            this.jq.empty().append($result);\n        });\n\n        this.runner.activate();\n\n        if (this.runner.editor) {\n            atom.commands.add(\"atom-text-editor\", \"path-changed\", () => this.jq.trigger(\"title-changed\"));\n        }\n    }\n\n    renderReVIEW() {\n        this.runner.doCompile();\n    }\n\n    getTitle(): string {\n        if (this.editor) {\n            return `${this.editor.getTitle()} Preview`;\n        } else {\n            return \"Re:VIEW Preview\";\n        }\n    }\n\n    getURI(): string {\n        return `language-review://${V.previewHost}/${this.editorId}`;\n    }\n\n    getPath(): string {\n        if (this.editor) {\n            return this.editor.getPath();\n        }\n        return null;\n    }\n\n    showError(result: any = {}) {\n        let failureMessage = result.message;\n\n        this.jq.html($$$(function(this: any) {\n            this.h2(\"Previewing Re:VIEW Failed\");\n            if (failureMessage) {\n                return this.h3(failureMessage);\n            }\n        }));\n    }\n\n    showLoading() {\n        this.jq.html($$$(function(this: any) {\n            this.div({ class: \"review-spinner\" }, \"Loading Re:VIEW\\u2026\");\n        }));\n    }\n\n    resolveImagePaths(html: any): JQuery {\n        let $html = $(html);\n        let imgList = $html.find(\"img\");\n        for (let i = 0; i < imgList.length; i++) {\n            let img = $(imgList[i]);\n            let src = img.attr(\"src\");\n            if (src.match(/^(https?:\\/\\/)/)) {\n                continue;\n            }\n            img.attr(\"src\", path.resolve(path.dirname(this.getPath()), src));\n        }\n\n        return $html;\n    }\n}\n\natom.deserializers.add(ReVIEWPreviewView);\n"]}