{"version":3,"file":"review-outline-view.js","sourceRoot":"","sources":["review-outline-view.ts"],"names":[],"mappings":"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","sourcesContent":["import { SelectListView, $, $$ } from \"atom-space-pen-views\";\nimport { Point } from \"atom\";\n\nimport * as ReVIEW from \"review.js\";\n\nimport * as logger from \"../util/logger\";\nimport ReVIEWRunner from \"../util/review-runner\";\n\nexport default class ReVIEWOutlineView extends SelectListView {\n    static activate() {\n        new ReVIEWOutlineView();\n    }\n\n    constructor() {\n        super();\n        this.jq.addClass(\"review-outline overlay from-top\");\n    }\n\n    get jq(): JQuery {\n        // dirty hack\n        return <any>this;\n    }\n\n    getFilterKey() {\n        return \"labelName\";\n    }\n\n    toggle() {\n        if (this.jq.hasParent()) {\n            this.cancel();\n        } else {\n            this.attach();\n        }\n    }\n\n    attach() {\n        this.storeFocusedElement();\n\n        let editor = atom.workspace.getActiveTextEditor();\n        let runner = new ReVIEWRunner({ editor: editor });\n        runner.on(\"report\", _reports => {\n            logger.log(\"Re:VIEW linter ReVIEWRunner compile\");\n            if (runner.lastSymbols) {\n                let symbols = runner.lastSymbols.filter(symbol => symbol.symbolName === \"hd\");\n                this.setItems(symbols);\n            } else {\n                logger.log(\"not compiled...\");\n                atom.beep();\n            }\n        });\n        runner.doCompile();\n\n        $(atom.views.getView(atom.workspace)).append(this.jq); // TODO is this implementation on the right way?\n        this.focusFilterEditor();\n    }\n\n    cancelled() {\n        this.jq.remove();\n    }\n\n    viewForItem(symbol: ReVIEW.Symbol): JQuery {\n        let repeatString = (times: number, str: string, result = \"\"): string => {\n            if (times === 0) {\n                return result;\n            } else {\n                return repeatString(times - 1, str, result + str);\n            }\n        };\n\n        let header: ReVIEW.HeadlineSyntaxTree = <any>symbol.node;\n        let prefix = repeatString(header.level, \"=\");\n        let text = `${prefix} ${symbol.labelName}`;\n\n        return $$(function(this: any) {\n            // this eq View(class)\n            this.li(() => {\n                this.span(text);\n            });\n        });\n    }\n\n    confirmed(symbol: ReVIEW.Symbol) {\n        // onSelected的な\n        this.cancel();\n        // emit したい…\n        let pane: any = atom.workspace.getActivePane();\n        if (!pane || typeof pane.getActiveEditor !== \"function\") {\n            atom.beep();\n            return;\n        }\n        let editor: AtomCore.IEditor = pane.getActiveEditor();\n        let point = Point.fromObject({ row: symbol.node.location.start.line - 1, column: 0 });\n        editor.setCursorBufferPosition(point);\n    }\n}\n"]}